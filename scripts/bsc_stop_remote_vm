#!/bin/bash

WORK_DIR=$1
if [ "$#" -ne 1 ] || ! [ -d "${WORK_DIR}" ]; then
  echo "Expecting path to work directory as first argument."
  exit 1
fi

cd $WORK_DIR
IP=$(make show-vms | grep -A 1 "EsxVmNode" | egrep "ipaddr: [0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}" | sed 's/ipaddr://' | head -n 1)
if [ -z "$IP" ]; then
  echo "No remote vm to stop!"
else
  make stop-remote-vms
fi

